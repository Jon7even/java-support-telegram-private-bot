# SupportBot v1.0
> Всем привет! Перед вами небольшой внутренний бот-помощник для малой компании. Помогает улучшить бизнес-процессы. 
> - Работает с товарами по артикулам (В процессе рефакторинга)
> - Работает с клиентами для выдачи презентов (В процессе рефакторинга)
> - Предоставляет нейросети для сотрудников по API (В процессе рефакторинга)
>


> [!IMPORTANT]
> Создано с помощью:
> - Java 17
> - Telegram Bots
> - RabbitMQ
> - Apache Maven
> - Spring boot 3.2.5
> - Hibernate
> - PostgreSQL
> - Liquibase
> - Lombok 
> - MapStruct
> - JUnit
> - Mockito
> 


> [!NOTE]
> Что это? Это микросервисное приложение с использованием `API Telegram Bots`. Бот имеет довольно специфическое
> применение (применим именно для конкретной компании), однако перестроить его под любые другие нужды не составит
> труда. Проектируется как шаблон для других ботов. Текущий uptime прошлых версий за 4 месяца - 100%. Имеет два 
> сервиса Dispatcher(Диспетчер) и Node(Узел). 
>


## Архитектура приложения


![Архитектура приложения на схеме](/docs/images/architecture.jpg)

 
Приложение использует паттерн `MVC` (Model, View, Controller)

`Dispatcher` - является `Controller`, отвечает за получение обновлений(данных) в Telegram через 
TelegramLongPollingBot. Имеет валидацию данных и сервис авторизации, сообщается с базой для этого. 
Работает по принципу Controller, всю статичную и первичную нагрузку принимает на себя и пропускает запрос дальше, 
только когда он уже касается бизнес-логики. Далее, определяет тип сообщения, и посредством брокера сообщений 
отправляет запрос в Node. 

`Node` - является `Model`, принимает входящие сообщения от RabbitMQ и дальше обрабатывает их в зависимости 
от типа сообщения. Здесь находится основная бизнес-логика бота. 

В качестве `View` используется API Telegram.


## Сборка и запуск

### Обязательное наличие на запускаемой машине:

- Java 17
- Docker version 24.0.5
- Docker Compose version v2.20

### Действия для запуска:

- Переименовываем файл переменных окружения `.env.Default` в `.env`(если требуется, внесите изменения)
- Запустить Docker engine (если не работает, найдите инструкцию подключения)
- Находясь в главном каталоге с помощью Maven собрать проект `mvn clean install`
  Проект соберется и запустятся автоматические тесты. Обратите внимание, в тестах используются тест-контейнеры.
  Именно поэтому нужно запустить докер перед выполнением тестов, сначала загрузятся необходимые образы, затем по
  очереди будут запускаться контейнеры. После того как тесты отработают, контейнеры для тестов сами деактивируется,
  но сами образы останутся, их нужно будет удалить.
- Если есть потребность и не хочется ждать, можно собрать проект без тестов, используя специальный подготовленный
  `maven` профиль для этого, действия почти те же:
  Находясь в главном каталоге с помощью Maven собрать проект `mvn clean install -Pno-tests-tbp`
- Далее, в главном каталоге командой `docker-compose up -d` компилируем образы для контейнеров. Соберется образ СУБД
  PostgreSQL и образ с нашим собранным Spring Boot приложением(обязательно должно быть скомпилировано до запуска).